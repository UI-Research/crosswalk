<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Standardizing Longitudinal Data • crosswalk</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Standardizing Longitudinal Data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">crosswalk</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/standardizing-longitudinal-data.html">Standardizing Longitudinal Data</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Standardizing Longitudinal Data</h1>
            
      

      <div class="d-none name"><code>standardizing-longitudinal-data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>A common challenge with longitudinal tract-level data is that census
tract boundaries change between decennial censuses. Data from before
2020 typically uses 2010 tract definitions, while more recent data uses
2020 tract definitions. To analyze trends over time, you need to
standardize all years to a consistent tract vintage.</p>
<p>This vignette demonstrates how the <code>crosswalk</code> package
efficiently handles this task using the Urban Institute’s <a href="https://datacatalog.urban.org/dataset/home-mortgage-disclosure-act-neighborhood-summary-files-census-tract-level" class="external-link">HMDA
Neighborhood Summary Files</a>, which provide tract-level mortgage
lending data from 2018-2023. The 2018-2021 files use 2010 tract
definitions, while 2022-2023 use 2020 tract definitions.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ui-research.github.io/crosswalk/">crosswalk</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-1-download-the-data">Step 1: Download the Data<a class="anchor" aria-label="anchor" href="#step-1-download-the-data"></a>
</h2>
<p>The Urban Institute publishes annual HMDA tract-level summary files.
Let’s download all six years (2018-2023):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## metadata object describing data year/vintage/url</span></span>
<span><span class="va">metadata</span> <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span> <span class="va">year</span>, <span class="op">~</span> <span class="va">vintage</span>, <span class="op">~</span> <span class="va">url</span>,</span>
<span>  <span class="fl">2018</span>, <span class="fl">2010</span>, <span class="st">"https://urban-data-catalog.s3.amazonaws.com/drupal-root-live/2023/12/20/hmda_tract_2018.csv"</span>,</span>
<span>  <span class="fl">2019</span>, <span class="fl">2010</span>, <span class="st">"https://urban-data-catalog.s3.amazonaws.com/drupal-root-live/2023/12/20/hmda_tract_2019.csv"</span>,</span>
<span>  <span class="fl">2020</span>, <span class="fl">2010</span>, <span class="st">"https://urban-data-catalog.s3.amazonaws.com/drupal-root-live/2023/12/20/hmda_tract_2020.csv"</span>,</span>
<span>  <span class="fl">2021</span>, <span class="fl">2010</span>, <span class="st">"https://urban-data-catalog.s3.amazonaws.com/drupal-root-live/2023/12/20/hmda_tract_2021.csv"</span>,</span>
<span>  <span class="fl">2022</span>, <span class="fl">2020</span>, <span class="st">"https://urban-data-catalog.s3.amazonaws.com/drupal-root-live/2023/12/20/hmda_tract_2022.csv"</span>,</span>
<span>  <span class="fl">2023</span>, <span class="fl">2020</span>, <span class="st">"https://urban-data-catalog.s3.amazonaws.com/drupal-root-live/2024/12/17/hmda_tract_2023.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## iterate of the metadata object and read in data for each year</span></span>
<span><span class="va">hmda_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/pmap.html" class="external-link">pmap</a></span><span class="op">(</span><span class="va">metadata</span>, <span class="kw">function</span><span class="op">(</span><span class="va">url</span>, <span class="va">year</span>, <span class="va">vintage</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="va">url</span>, show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      vintage <span class="op">=</span> <span class="va">vintage</span>,</span>
<span>      data_year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hmda_data</span><span class="op">)</span> <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">year</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Let’s inspect the structure of the data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check dimensions of each year</span></span>
<span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">hmda_data</span>, <span class="va">dim</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the 2018 data (2010 tract vintage)</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">hmda_data</span><span class="op">[[</span><span class="st">"2018"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-2-prepare-data-for-crosswalking">Step 2: Prepare Data for Crosswalking<a class="anchor" aria-label="anchor" href="#step-2-prepare-data-for-crosswalking"></a>
</h2>
<p>The HMDA data includes a <code>tractid</code> column that contains
the 11-digit tract GEOID. Let’s prepare a subset of variables for
crosswalking. We’ll focus on count variables (total applications by
race/ethnicity) which require the <code>count_</code> prefix for
automatic detection by <code><a href="../reference/crosswalk_data.html">crosswalk_data()</a></code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepare_hmda</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename_with</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">matches</a></span><span class="op">(</span><span class="st">"^geo20"</span><span class="op">)</span>, .fn <span class="op">=</span> <span class="op">~</span> <span class="st">"source_geoid"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>      <span class="va">source_geoid</span>,</span>
<span>      <span class="va">vintage</span>,</span>
<span>      <span class="va">data_year</span>,</span>
<span>      <span class="co"># Count variables: rename with count_ prefix for automatic detection</span></span>
<span>      count_race_white_purchase <span class="op">=</span> <span class="va">race_white_purchase</span>,</span>
<span>      count_owner_purchase_originations <span class="op">=</span> <span class="va">owner_purchase_originations</span>,</span>
<span>      median_owner_loan_amount <span class="op">=</span> <span class="va">owner_loan_amount_median</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>source_geoid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">source_geoid</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">hmda_prepared</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">hmda_data</span>, <span class="va">prepare_hmda</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-3-obtain-the-20102020-tract-crosswalk">Step 3: Obtain the 2010→2020 Tract Crosswalk<a class="anchor" aria-label="anchor" href="#step-3-obtain-the-20102020-tract-crosswalk"></a>
</h2>
<p>Here’s where <code>crosswalk</code> shines. We need a single
crosswalk to convert all 2010-vintage tracts to 2020-vintage tracts. The
package fetches this from IPUMS NHGIS:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tract_crosswalk</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_crosswalk.html">get_crosswalk</a></span><span class="op">(</span></span>
<span>  source_geography <span class="op">=</span> <span class="st">"tract"</span>,</span>
<span>  target_geography <span class="op">=</span> <span class="st">"tract"</span>,</span>
<span>  source_year <span class="op">=</span> <span class="fl">2010</span>,</span>
<span>  target_year <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>  weight <span class="op">=</span> <span class="st">"population"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the crosswalk plan</span></span>
<span><span class="va">tract_crosswalk</span><span class="op">$</span><span class="va">message</span></span></code></pre></div>
<p>The crosswalk contains allocation factors that specify how to
distribute values from 2010 tracts to 2020 tracts. When tract boundaries
changed, a single 2010 tract may map to multiple 2020 tracts (or vice
versa), with allocation factors summing to 1.</p>
</div>
<div class="section level2">
<h2 id="step-4-apply-the-crosswalk-to-2018-2021-data">Step 4: Apply the Crosswalk to 2018-2021 Data<a class="anchor" aria-label="anchor" href="#step-4-apply-the-crosswalk-to-2018-2021-data"></a>
</h2>
<p>Now we apply the crosswalk to the four years of data that use 2010
tract definitions:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Years that need crosswalking (2010 vintage)</span></span>
<span><span class="va">years_to_crosswalk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2018"</span>, <span class="st">"2019"</span>, <span class="st">"2020"</span>, <span class="st">"2021"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply crosswalk to each year</span></span>
<span><span class="va">hmda_crosswalked</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_if.html" class="external-link">map_if</a></span><span class="op">(</span></span>
<span>  .x <span class="op">=</span> <span class="va">hmda_prepared</span>, </span>
<span>  .p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hmda_prepared</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">years_to_crosswalk</span>,</span>
<span>  .f <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/crosswalk_data.html">crosswalk_data</a></span><span class="op">(</span></span>
<span>      data <span class="op">=</span> <span class="va">.x</span>,</span>
<span>      crosswalk <span class="op">=</span> <span class="va">tract_crosswalk</span>,</span>
<span>      geoid_column <span class="op">=</span> <span class="st">"source_geoid"</span>,</span>
<span>      show_join_quality <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">## how many source records are we unable to crosswalk each year?</span></span>
<span><span class="co">## excluding those with an "X"--which is used to retain valid observations</span></span>
<span><span class="co">## that, in the source data, do not have a valid tract identifier--very few:</span></span>
<span><span class="va">hmda_crosswalked</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span> </span>
<span>    <span class="va">.x</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="st">"join_quality"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html" class="external-link">pluck</a></span><span class="op">(</span><span class="st">"data_geoids_unmatched"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="va">.</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"X"</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hmda_combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">hmda_crosswalked</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co">## data for years that are crosswalked have slightly different/additional columsn</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    geoid <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">geoid</span><span class="op">)</span>, <span class="va">source_geoid</span>, <span class="va">geoid</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">geography_name</span>, <span class="va">source_geoid</span>, <span class="va">vintage</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">geoid</span>, <span class="va">data_year</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the result</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">hmda_combined</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="result-a-panel-dataset-in-2020-tract-definitions">Result: A Panel Dataset in 2020 Tract Definitions<a class="anchor" aria-label="anchor" href="#result-a-panel-dataset-in-2020-tract-definitions"></a>
</h2>
<p>We now have a single dataframe with all six years of HMDA data
standardized to 2020 tract definitions:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Unique tracts per year</span></span>
<span><span class="va">hmda_combined</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">data_year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>n_tracts <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">geoid</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Will Curran-Groome.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
